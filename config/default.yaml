# Default configuration (checked into source control).
#
# Copy this file to `config/config.yaml` and override only what you need for your
# local deployment (camera URL, counting line, cloud settings, etc.).

# Camera settings
camera:
  # backend selection:
  # - "opencv": supports USB webcams (device_id: 0) AND RTSP IP cameras
  # - "picamera2": supports Raspberry Pi CSI cameras (ignores device_id)
  backend: "opencv"
  # device_id: 0 for USB webcam, or omit for RTSP (loaded from secrets_file)
  device_id: 0
  # For RTSP cameras: put rtsp_url + credentials in secrets/camera_secrets.yaml
  # Example secrets file:
  #   rtsp_url: "rtsp://192.168.1.100/live0"
  #   username: "user"
  #   password: "pass"
  secrets_file: "secrets/camera_secrets.yaml"
  resolution: [1280, 720]        # Camera resolution [width, height]
  fps: 30                        # Frames per second
  # Optional image calibration (applied after capture, before detection)
  # swap_rb: true can fix "wrong colors" when a pipeline delivers RGB but code expects BGR.
  # rotate: 0|90|180|270
  # flip_horizontal / flip_vertical: booleans
  swap_rb: false
  rotate: 0
  flip_horizontal: false
  flip_vertical: false

# Detection settings
detection:
  # backend: "bgsub" (default, classical CV) or "yolo" (AI-based; requires optional deps)
  backend: "bgsub"
  min_contour_area: 1000         # Minimum contour area for vehicle detection
  detect_shadows: true           # Whether to detect shadows in background subtraction

  # YOLO settings (used only when detection.backend == "yolo")
  yolo:
    model: ""                    # e.g., "yolov8n.pt" (Ultralytics) or a local path
    conf_threshold: 0.25
    iou_threshold: 0.45
    # classes: [2, 3, 5, 7]      # optional filter by class IDs (model-dependent)
    # class_name_overrides: {}   # optional mapping of class_id -> display name

# Counting strategy (line or gate)
counting:
  # Gate-based counting (two lines). Define line_a and line_b as ratios.
  line_a: [[0.2, 1.0], [0., 0.0]]   # Gate A line (ratios)
  line_b: [[0.8, 1.0], [1.0, 0.0]]  # Gate B line (ratios)
  direction_labels:
    a_to_b: "northbound"
    b_to_a: "southbound"
  gate:
    max_gap_frames: 30
    min_age_frames: 3
    min_displacement_px: 15.0

# Storage settings
storage:
  local_database_path: "data/database.sqlite"  # Path to local SQLite database
  retention_days: 30                          # How long to keep data locally
  use_cloud_storage: true                     # Whether to use cloud storage
  sync_enabled: true                          # Whether to sync data to cloud

# Tracking settings (vehicle tracker configuration)
tracking:
  max_frames_since_seen: 10     # Frames to keep a track alive without detection
  min_trajectory_length: 3      # Points needed before deciding direction
  iou_threshold: 0.3            # IoU match threshold between detections

# System settings
log_path: "logs/traffic_monitor.log"  # Path to log file
log_level: "INFO"                     # Logging level (DEBUG, INFO, WARNING, ERROR)

# Pipeline settings (experimental)
pipeline:
  # Use the new pipeline engine (observation layer).
  # Set to true to enable the new modular pipeline architecture.
  # Default: false (uses legacy main loop for safety).
  use_new_engine: false


