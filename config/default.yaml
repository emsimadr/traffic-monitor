# Default configuration (checked into source control).
#
# Copy this file to `config/config.yaml` and override only what you need for your
# local deployment (camera URL, counting line, cloud settings, etc.).

# Camera settings
camera:
  # backend selection:
  # - "opencv": supports USB webcams (device_id: 0) AND RTSP IP cameras
  # - "picamera2": supports Raspberry Pi CSI cameras (ignores device_id)
  backend: "opencv"
  # device_id: 0 for USB webcam, or omit for RTSP (loaded from secrets_file)
  device_id: 0
  # For RTSP cameras: put rtsp_url + credentials in secrets/camera_secrets.yaml
  # Example secrets file:
  #   rtsp_url: "rtsp://192.168.1.100/live0"
  #   username: "user"
  #   password: "pass"
  secrets_file: "secrets/camera_secrets.yaml"
  resolution: [1280, 720]        # Camera resolution [width, height]
  fps: 30                        # Frames per second
  # Optional image calibration (applied after capture, before detection)
  # swap_rb: true can fix "wrong colors" when a pipeline delivers RGB but code expects BGR.
  # rotate: 0|90|180|270
  # flip_horizontal / flip_vertical: booleans
  swap_rb: false
  rotate: 0
  flip_horizontal: false
  flip_vertical: false

# Detection settings
detection:
  # backend: "bgsub" (default, classical CV) or "yolo" (AI-based; requires optional deps)
  backend: "bgsub"
  min_contour_area: 1000         # Minimum contour area for vehicle detection
  detect_shadows: true           # Whether to detect shadows in background subtraction

  # YOLO settings (used only when detection.backend == "yolo")
  yolo:
    model: ""                    # e.g., "yolov8n.pt" (Ultralytics) or a local path
    conf_threshold: 0.25
    iou_threshold: 0.45
    # classes: [2, 3, 5, 7]      # optional filter by class IDs (model-dependent)
    # class_name_overrides: {}   # optional mapping of class_id -> display name

# Counting strategy
counting:
  # mode: "line" (single-line crossing) or "gate" (two-line gate sequence)
  # - line: counts when track crosses a single line (faster, simpler)
  # - gate: counts when track crosses line_a then line_b (A_TO_B) or vice versa (B_TO_A)
  mode: "line"  # Default "line" for backward compatibility
  
  # Line definitions (as ratios [0-1] of frame dimensions)
  # For "line" mode: only line_a is used
  # For "gate" mode: both line_a and line_b are required
  line_a: [[0.2, 1.0], [0.0, 0.0]]   # Line A (ratios)
  line_b: [[0.8, 1.0], [1.0, 0.0]]   # Line B (ratios)
  
  # Direction labels (how directions appear in logs/UI)
  direction_labels:
    # For "line" mode:
    positive: "inbound"   # Crossing from negative to positive side
    negative: "outbound"  # Crossing from positive to negative side
    # For "gate" mode:
    a_to_b: "northbound"  # Crossed A then B
    b_to_a: "southbound"  # Crossed B then A
  
  # Counting constraints (apply to both modes)
  min_age_frames: 3           # Min track age before counting
  min_displacement_px: 15.0   # Min movement distance (pixels) for valid count
  
  # Gate-specific settings (only used when mode: "gate")
  max_gap_frames: 30          # Max frames between line A and line B crossings

# Storage settings
storage:
  local_database_path: "data/database.sqlite"  # Path to local SQLite database
  retention_days: 30                          # How long to keep data locally
  use_cloud_storage: true                     # Whether to use cloud storage
  sync_enabled: true                          # Whether to sync data to cloud

# Tracking settings (vehicle tracker configuration)
tracking:
  max_frames_since_seen: 10     # Frames to keep a track alive without detection
  min_trajectory_length: 3      # Points needed before deciding direction
  iou_threshold: 0.3            # IoU match threshold between detections

# System settings
log_path: "logs/traffic_monitor.log"  # Path to log file
log_level: "INFO"                     # Logging level (DEBUG, INFO, WARNING, ERROR)

# Pipeline settings (experimental)
pipeline:
  # Use the new pipeline engine (observation layer).
  # Set to true to enable the new modular pipeline architecture.
  # Default: false (uses legacy main loop for safety).
  use_new_engine: false


