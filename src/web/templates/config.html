{% extends "_layout.html" %}
{% block content %}
  <h1>Configuration</h1>

  <section class="card">
    <p class="muted">
      This page edits <code>config/config.yaml</code> (overrides only). Defaults live in
      <code>config/default.yaml</code>.
    </p>
    <p class="muted">
      Counting settings (line/gate, labels) can be edited below and applied into the overrides JSON.
      Click “Apply counting changes” to update the overrides text, then “Save overrides” to persist.
    </p>

    <h2>Counting configuration (quick edit)</h2>
    <div class="grid grid-2">
      <div>
        <label class="label">Direction labels</label>
        <div class="row" style="gap:8px;">
          <input id="labelAtoB" class="input" placeholder="a_to_b label" />
          <input id="labelBtoA" class="input" placeholder="b_to_a label" />
        </div>
      </div>
      <div>
        <label class="label">Gate A p1 [x1,y1]</label>
        <input id="lineA1" class="input" placeholder="0.2,1.0" />
        <label class="label">Gate A p2 [x2,y2]</label>
        <input id="lineA2" class="input" placeholder="0.0,0.0" />
      </div>
      <div>
        <label class="label">Gate B p1 [x1,y1]</label>
        <input id="lineB1" class="input" placeholder="0.8,1.0" />
        <label class="label">Gate B p2 [x2,y2]</label>
        <input id="lineB2" class="input" placeholder="1.0,0.0" />
      </div>
      <div>
        <label class="label">Gate params</label>
        <div class="row" style="gap:8px; flex-wrap:wrap;">
          <input id="gateMaxGap" class="input" placeholder="max_gap_frames" />
          <input id="gateMinAge" class="input" placeholder="min_age_frames" />
          <input id="gateMinDisp" class="input" placeholder="min_displacement_px" />
        </div>
      </div>
    </div>
    <div class="row" style="margin-top:10px;">
      <button id="applyCountingBtn" class="btn">Apply counting changes to overrides</button>
      <span id="countingStatus" class="muted"></span>
    </div>

    <h2>Overrides (YAML)</h2>
    <textarea id="configText" class="textarea" spellcheck="false">{{ overrides | tojson(indent=2) }}</textarea>
    <div class="row">
      <button id="saveConfigBtn" class="btn">Save overrides</button>
      <span id="saveStatus" class="muted"></span>
    </div>
  </section>

  <section class="card">
    <h2>Effective config (read-only)</h2>
    <pre>{{ cfg | tojson(indent=2) }}</pre>
  </section>
  <script>
    window.countingDefaults = {{ cfg.get("counting", {}) | tojson }};
    window.countingOverrides = {{ overrides.get("counting", {}) | tojson }};
  </script>
{% endblock %}

